

    CAP理论

 1、CAP理论 Consistency (一致性)，Availability （可用性），Partition Tolerance（分区容错性）

    一致性：所有节点访问同一份最新的数据副本
    可用性：非故障节点在合理的时间内返回合理的响应（不是错误或者超时的响应）
    分区容错性：分布式系统出现网络分区的时候，仍然能够对外提供服务。

    网络分区：
        分布式系统中，多个节点之间的网络本来是联通的，但是因为某些故障（比如部分节点网络出现了问题）某些节点之间不连通了，
        整个网络就分成了几块区域，这就叫网络分区。

        当发生网络分区的时候，如果我们要继续服务，那么强一致性和可用性只能 2 选 1。也就是说当网络分区之后 P 是前提，决定了 P 之后才有 C 和 A 的选择。也就是说分区容错性（Partition tolerance）我们是必须要实现的。
        简而言之就是：CAP 理论中分区容错性 P 是一定要满足的，在此基础上，只能满足可用性 A 或者一致性 C。


  2、分布式系统 保证 CP 和 AP ，无法保证 CA
    1、为啥无同时保证 CA 呢？
      举个例子：若系统出现“分区”，系统中的某个节点在进行写操作。为了保证 C， 必须要禁止其他节点的读写操作，
      这就和 A 发生冲突了。如果为了保证 A，其他节点的读写操作正常的话，那就和 C 发生冲突了。


      ZooKeeper 保证的是 CP。 任何时刻对 ZooKeeper 的读请求都能得到一致性的结果，但是， ZooKeeper 不保证每次请求的可用性比如在 Leader 选举过程中或者半数以上的机器不可用的时候服务就是不可用的。


 3、BASE 理论思想

    BASE 理论是对CAP中一致性C 和 可用性A权衡的结果，是基于CAP定理逐步演化而来的，具体指，Basically Available（基本可用），Soft-state(软状态)，
    和 Eventually Consistent(最终一致性)。 核心思想是，即使无法做到强一致性，但每个应用可以根据自身的业务特点，采用适当的方式来使系统达到最终一致性。

     注意：BASE 理论本质上是对 CAP 的延伸和补充，更具体地说，是对 CAP 中 AP 方案的一个补充。


    1. 基本可用
        基本可用是指分布式系统在出现不可预知故障的时候，允许损失部分可用性。但是，这绝不等价于系统不可用。
        什么叫允许损失部分可用性呢？

        响应时间上的损失: 正常情况下，处理用户请求需要 0.5s 返回结果，但是由于系统出现故障，处理用户请求的时间变为 3 s。
        系统功能上的损失：正常情况下，用户可以使用系统的全部功能，但是由于系统访问量突然剧增，系统的部分非核心功能无法使用。

     2. 软状态
            软状态指允许系统中的数据存在中间状态（CAP 理论中的数据不一致），并认为该中间状态的存在不会影响系统的整体可用性，即允许系统在不同节点的数据副本之间进行数据同步的过程存在延时。
     3. 最终一致性
        最终一致性强调的是系统中所有的数据副本，在经过一段时间的同步后，最终能够达到一个一致的状态。因此，最终一致性的本质是需要系统保证最终数据能够达到一致，而不需要实时保证系统数据的强一致性。

        分布式一致性的 3 种级别：
           强一致性 ：系统写入了什么，读出来的就是什么。
           弱一致性 ：不一定可以读取到最新写入的值，也不保证多少时间之后读取到的数据是最新的，只是会尽量保证某个时刻达到数据一致的状态。
           最终一致性 ：弱一致性的升级版。，系统会保证在一定时间内达到数据一致的状态，

           ！！！ 业界比较推崇是最终一致性级别，但是某些对数据一致要求十分严格的场景比如银行转账还是要保证强一致性。

